<div class="fixed inset-0 bg-black bg-opacity-50 dark:bg-black/70 flex items-center justify-center p-4 z-50">
  <div class="bg-white dark:bg-slate-800 rounded-lg max-w-2xl w-full p-6 max-h-[80vh] flex flex-col">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-slate-100 flex items-center space-x-2">
          <app-icon name="link" class="w-6 h-6"></app-icon>
          <span>Link Child Ticket</span>
        </h2>
        <button (click)="close.emit()" class="text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200">
            <app-icon name="xcircle" class="w-6 h-6"></app-icon>
        </button>
    </div>
    <p class="text-sm text-gray-600 dark:text-slate-400 mb-4">
      Search for a ticket to link as a child to the current parent ticket: <span class="font-semibold text-gray-800 dark:text-slate-200">#{{ currentTicket().id }} - {{ currentTicket().subject }}</span>.
    </p>

    <div class="relative mb-4">
      <span class="absolute left-3 top-2.5 text-gray-400 dark:text-slate-500">
        <app-icon name="search" class="w-5 h-5"></app-icon>
      </span>
      <input
        type="text"
        placeholder="Search for a ticket by ID, subject, or customer..."
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        class="pl-10 pr-4 py-2 w-full border border-gray-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white dark:bg-slate-700 dark:text-slate-200"
      />
    </div>

    <div class="flex-1 overflow-y-auto border border-gray-200 dark:border-slate-700 rounded-lg divide-y divide-gray-200 dark:divide-slate-700">
        @for(ticket of availableTickets(); track ticket.id) {
            <div 
                (click)="selectedTicketId.set(ticket.id)"
                [class]="'p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 flex justify-between items-center ' + (selectedTicketId() === ticket.id ? 'bg-indigo-50 dark:bg-indigo-900/50' : '')">
                <div>
                    <p class="font-medium text-gray-800 dark:text-slate-200">#{{ ticket.id }} - {{ ticket.subject }}</p>
                    <p class="text-sm text-gray-500 dark:text-slate-400">{{ ticket.customer }}</p>
                </div>
                @if (selectedTicketId() === ticket.id) {
                    <app-icon name="checkcircle" class="w-5 h-5 text-indigo-600 dark:text-indigo-400"></app-icon>
                }
            </div>
        }
        @if(availableTickets().length === 0) {
            <p class="p-4 text-center text-gray-500 dark:text-slate-400">No available tickets found.</p>
        }
    </div>

    <div class="flex justify-end space-x-3 mt-6">
      <button type="button" (click)="close.emit()" class="px-6 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-700 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-700 transition">Cancel</button>
      <button 
        type="button" 
        (click)="handleLink()" 
        [disabled]="!selectedTicketId()"
        class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
        Link Ticket
      </button>
    </div>
  </div>
</div>