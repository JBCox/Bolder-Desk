<div class="flex h-full bg-gray-50 dark:bg-slate-900">
  <!-- Template List -->
  <div class="w-1/4 border-r border-gray-200 dark:border-slate-700 flex flex-col bg-white dark:bg-slate-800">
    <div class="p-4 border-b border-gray-200 dark:border-slate-700 flex justify-between items-center">
      <h2 class="text-lg font-semibold">Form Templates</h2>
      <button (click)="createNewTemplate()" class="p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-md">
        <app-icon name="plus-circle" class="w-6 h-6 text-indigo-600"></app-icon>
      </button>
    </div>
    <div class="flex-1 overflow-y-auto">
      @for(template of templates(); track template.id) {
        <div (click)="selectTemplate(template)" [class]="'p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 border-l-4 ' + (selectedTemplate()?.id === template.id ? 'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/50' : 'border-transparent')">
          <p class="font-medium">{{ template.name }}</p>
        </div>
      }
    </div>
  </div>

  <!-- Form Editor -->
  <div class="w-1/2 p-8 overflow-y-auto">
    @if(selectedTemplate(); as template) {
      <div class="bg-white dark:bg-slate-800 p-6 rounded-lg border border-gray-200 dark:border-slate-700">
        <input type="text" [(ngModel)]="template.name" class="text-2xl font-bold w-full bg-transparent border-0 border-b-2 border-transparent focus:border-indigo-500 focus:ring-0 p-1 mb-6">
        
        <div class="space-y-4">
          @for(field of template.fields; track field.id) {
            <div (click)="selectField(field)" [class]="'p-4 rounded-md cursor-pointer relative group ' + (selectedField()?.id === field.id ? 'border-2 border-indigo-500 bg-indigo-50 dark:bg-indigo-900/50' : 'border border-gray-300 dark:border-slate-600 hover:border-indigo-400')">
              <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">{{ field.label }} @if(field.required){<span class="text-red-500">*</span>}</label>
              @switch (field.type) {
                @case('text') { <input type="text" class="w-full form-input-preview" disabled> }
                @case('textarea') { <textarea rows="3" class="w-full form-input-preview" disabled></textarea> }
                @case('dropdown') { 
                  <select class="w-full form-input-preview" disabled>
                    @for(option of field.options; track $index) { <option>{{option}}</option> }
                  </select>
                }
                @case('checkbox') { <div class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" disabled><label class="ml-2 text-sm text-gray-900 dark:text-slate-200">Checkbox</label></div> }
                @case('radio') {
                  <div class="space-y-2">
                    @for(option of field.options; track $index) {
                      <div class="flex items-center"><input type="radio" name="{{field.id}}" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500" disabled><label class="ml-2 text-sm text-gray-900 dark:text-slate-200">{{option}}</label></div>
                    }
                  </div>
                }
              }
              <div class="absolute top-2 right-2 flex items-center space-x-1 opacity-0 group-hover:opacity-100">
                 <button class="p-1 text-gray-400 hover:text-gray-700 dark:hover:text-slate-200"><app-icon name="move" class="w-4 h-4"></app-icon></button>
                 <button (click)="removeField(field.id); $event.stopPropagation()" class="p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-500"><app-icon name="trash" class="w-4 h-4"></app-icon></button>
              </div>
            </div>
          }
        </div>

        <div class="mt-6 text-center">
            <p class="text-sm text-gray-500 mb-2">Add a new field:</p>
            <div class="flex justify-center flex-wrap gap-2">
                <button (click)="addField('text')" class="form-add-button">Text</button>
                <button (click)="addField('textarea')" class="form-add-button">Text Area</button>
                <button (click)="addField('dropdown')" class="form-add-button">Dropdown</button>
                <button (click)="addField('checkbox')" class="form-add-button">Checkbox</button>
                <button (click)="addField('radio')" class="form-add-button">Radio Buttons</button>
            </div>
        </div>
      </div>
      <div class="mt-8 flex justify-end">
          <button (click)="handleSave()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Save Template</button>
      </div>
    } @else {
      <div class="text-center text-gray-500 dark:text-slate-400 py-20">
        <p>Select a template to edit, or create a new one.</p>
      </div>
    }
  </div>
  
  <!-- Field Properties -->
  <div class="w-1/4 border-l border-gray-200 dark:border-slate-700 flex flex-col bg-white dark:bg-slate-800">
    <div class="p-4 border-b border-gray-200 dark:border-slate-700">
      <h2 class="text-lg font-semibold">Field Properties</h2>
    </div>
    <div class="flex-1 overflow-y-auto p-4">
      @if(selectedField(); as field) {
        <div class="space-y-4">
          <div>
            <label class="form-label">Label</label>
            <input type="text" [(ngModel)]="field.label" class="form-input">
          </div>
           <div>
            <label class="form-label">Name (for form control)</label>
            <input type="text" [(ngModel)]="field.name" class="form-input">
          </div>
           <div class="flex items-center">
            <input type="checkbox" [(ngModel)]="field.required" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
            <label class="ml-2 block text-sm text-gray-900 dark:text-slate-200">Required</label>
          </div>
          
          @if(field.type === 'dropdown' || field.type === 'radio') {
            <div>
                <label class="form-label">Options</label>
                <div class="space-y-2">
                    @for(option of field.options; track $index) {
                        <div class="flex items-center space-x-2">
                            <input type="text" [value]="option" (change)="updateOption(field, $index, $event)" class="form-input flex-1">
                            <button (click)="removeOption(field, $index)" class="p-1 text-gray-400 hover:text-red-500"><app-icon name="trash" class="w-4 h-4"></app-icon></button>
                        </div>
                    }
                </div>
                <button (click)="addOption(field)" class="mt-2 text-sm text-indigo-600 hover:underline">Add option</button>
            </div>
          }

          <div>
             <label class="form-label">Conditional Logic</label>
             <div class="p-3 bg-gray-50 dark:bg-slate-700/50 rounded-md text-sm">
                <p class="mb-2 text-gray-600 dark:text-slate-400">Show this field only if:</p>
                <select [(ngModel)]="field.conditionalLogic" class="form-input mb-2">
                    <option [ngValue]="null">Always show</option>
                    @for(otherField of selectedTemplate()?.fields; track otherField.id) {
                      @if (otherField.id !== field.id) {
                        <option [ngValue]="{ fieldId: otherField.id, value: '' }">{{ otherField.label }}</option>
                      }
                    }
                </select>
                @if(field.conditionalLogic) {
                     <input type="text" [(ngModel)]="field.conditionalLogic.value" placeholder="...has this value" class="form-input">
                }
             </div>
          </div>
        </div>
      } @else {
        <p class="text-center text-gray-500 dark:text-slate-400 pt-10">Select a field to edit its properties.</p>
      }
    </div>
  </div>
</div>

<style>
.form-input-preview {
  @apply block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-gray-50 dark:bg-slate-700 cursor-pointer;
}
.form-add-button {
  @apply px-3 py-1.5 text-sm bg-gray-100 dark:bg-slate-700 rounded-md hover:bg-gray-200 dark:hover:bg-slate-600;
}
.form-label {
 @apply block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1;
}
.form-input {
  @apply block w-full text-sm border-gray-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700;
}
</style>
