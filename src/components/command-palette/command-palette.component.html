
<div class="fixed inset-0 bg-black bg-opacity-60 dark:bg-black/70 z-50 flex justify-center pt-20" (click)="close.emit()">
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[60vh] flex flex-col" (click)="$event.stopPropagation()">
    <div class="p-3 border-b border-slate-200 dark:border-slate-700 flex items-center">
      <app-icon name="search" class="w-5 h-5 text-slate-400 mr-3"></app-icon>
      <input 
        type="text" 
        placeholder="Type a command or search..."
        autofocus
        [(ngModel)]="searchQuery"
        class="w-full bg-transparent border-0 focus:ring-0 text-slate-800 dark:text-slate-100 placeholder-slate-400"
      />
    </div>
    <div class="flex-1 overflow-y-auto">
      @if(flatResults().length > 0) {
        @for(group of searchResults(); track group.group) {
          <div class="p-2">
            <h3 class="px-2 text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase">{{ group.group }}</h3>
            <ul class="mt-1">
              @for(item of group.items; track item.id || item.name; let i = $index) {
                @let flatIndex = flatResults().indexOf(item);
                <li 
                  (click)="selectItem(item)"
                  (mouseenter)="selectedIndex.set(flatIndex)"
                  [class]="'flex items-center space-x-3 px-2 py-1.5 rounded-md cursor-pointer ' + (selectedIndex() === flatIndex ? 'bg-indigo-100 dark:bg-indigo-900/50' : '')">
                  <app-icon [name]="item.icon" class="w-5 h-5 text-slate-500"></app-icon>
                  <span class="text-sm text-slate-700 dark:text-slate-200">{{ item.name }}</span>
                </li>
              }
            </ul>
          </div>
        }
      } @else {
        <p class="p-8 text-center text-slate-500">No results found.</p>
      }
    </div>
  </div>
</div>
