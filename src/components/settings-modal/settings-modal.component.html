<div class="fixed inset-0 bg-black bg-opacity-50 dark:bg-black/70 flex items-center justify-center p-4 z-50">
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-5xl h-[90vh] flex flex-col">
    <div class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
      <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2">
        <app-icon name="settings" class="w-6 h-6"></app-icon>
        Settings
      </h2>
      <button (click)="close.emit()" class="text-slate-400 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-200">
        <app-icon name="x" class="w-6 h-6"></app-icon>
      </button>
    </div>
    <div class="flex-1 flex overflow-hidden">
      <!-- Sidebar -->
      <div class="w-1/4 p-4 border-r border-slate-200 dark:border-slate-700 overflow-y-auto">
        <nav class="space-y-1">
          <button (click)="activeTab.set('profile')" [class]="getTabClass('profile')">
            <app-icon name="user" class="w-5 h-5 mr-2"></app-icon>
            <span>My Profile</span>
          </button>
          <button (click)="activeTab.set('roles')" [class]="getTabClass('roles')">
            <app-icon name="users" class="w-5 h-5 mr-2"></app-icon>
            <span>Roles & Permissions</span>
          </button>
           <button (click)="activeTab.set('authentication')" [class]="getTabClass('authentication')">
            <app-icon name="shield" class="w-5 h-5 mr-2"></app-icon>
            <span>Authentication</span>
          </button>
           <button (click)="activeTab.set('automations')" [class]="getTabClass('automations')">
            <app-icon name="zap" class="w-5 h-5 mr-2"></app-icon>
            <span>Automation Rules</span>
          </button>
           <button (click)="activeTab.set('slas')" [class]="getTabClass('slas')">
            <app-icon name="sliders" class="w-5 h-5 mr-2"></app-icon>
            <span>SLA Policies</span>
          </button>
          <button (click)="activeTab.set('forms')" [class]="getTabClass('forms')">
            <app-icon name="layout-template" class="w-5 h-5 mr-2"></app-icon>
            <span>Form Templates</span>
          </button>
          <button (click)="activeTab.set('developer')" [class]="getTabClass('developer')">
            <app-icon name="code" class="w-5 h-5 mr-2"></app-icon>
            <span>Developer</span>
          </button>
          <button (click)="activeTab.set('audit')" [class]="getTabClass('audit')">
            <app-icon name="history" class="w-5 h-5 mr-2"></app-icon>
            <span>Audit Log</span>
          </button>
        </nav>
      </div>
      <!-- Content -->
      <div class="flex-1 overflow-y-auto">
        @switch (activeTab()) {
          @case ('profile') {
            <div class="p-6">
              <h3 class="text-lg font-medium text-slate-800 dark:text-slate-100">My Profile</h3>
              <p class="text-slate-500 dark:text-slate-400 mt-1">Manage your personal settings.</p>
              <div class="mt-4">
                <p><strong>Name:</strong> {{ currentAgent().name }}</p>
                <p><strong>Email:</strong> {{ currentAgent().email }}</p>
              </div>
            </div>
          }
          @case ('roles') {
            <app-roles-permissions [roles]="roles()" [allPermissions]="allPermissions()" (save)="saveRoles.emit($event)"></app-roles-permissions>
          }
          @case('automations') {
            <app-automation-modal [automationRules]="automationRules()" [groups]="groups()" [ticketViews]="ticketViews()" (close)="noop()" (update)="noop()"></app-automation-modal>
          }
          @case ('authentication') {
            <app-sso-settings [settings]="ssoSettings()" (save)="saveSsoSettings.emit($event)"></app-sso-settings>
          }
           @case ('audit') {
            <app-audit-log [log]="auditLog()"></app-audit-log>
           }
           @case ('developer') {
            <app-developer-settings
              [apiKeys]="apiKeys()"
              [webhooks]="webhooks()"
              (createApiKey)="createApiKey.emit($event)"
              (revokeApiKey)="revokeApiKey.emit($event)"
              (saveWebhooks)="saveWebhooks.emit($event)"
            ></app-developer-settings>
           }
          @default {
            <div class="p-6 text-slate-500">
              <p>This section is under construction.</p>
            </div>
          }
        }
      </div>
    </div>
  </div>
</div>